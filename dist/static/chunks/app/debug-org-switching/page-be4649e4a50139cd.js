(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8396],{35695:(e,t,a)=>{"use strict";var i=a(18999);a.o(i,"useParams")&&a.d(t,{useParams:function(){return i.useParams}}),a.o(i,"usePathname")&&a.d(t,{usePathname:function(){return i.usePathname}}),a.o(i,"useRouter")&&a.d(t,{useRouter:function(){return i.useRouter}}),a.o(i,"useSearchParams")&&a.d(t,{useSearchParams:function(){return i.useSearchParams}})},42099:(e,t,a)=>{"use strict";a.d(t,{N:()=>i});let i=(0,a(55647).UU)("https://yhznjxfzpthmyyhbhihp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inloem5qeGZ6cHRobXl5aGJoaWhwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyNDE0MzcsImV4cCI6MjA2OTgxNzQzN30.BlP9YoilaPopQgkZXZa-_WJPUIjnX9nTyYspaBV0Cqc")},45745:(e,t,a)=>{"use strict";a.d(t,{o:()=>s});var i=a(42099);class s{static async getOrganizationCounts(e){let t="counts_".concat(e),a=this.cache.get(t);if(a&&Date.now()-a.timestamp<this.CACHE_DURATION)return a.data;try{let a={},{count:s,error:n}=await i.N.from("contacts").select("*",{count:"exact",head:!0}).eq("organization_id",e);n||(a.contacts=s||0);let{count:r,error:o}=await i.N.from("locations").select("*",{count:"exact",head:!0}).eq("organization_id",e);o||(a.locations=r||0);let{count:c,error:l}=await i.N.from("documents").select("*",{count:"exact",head:!0}).eq("organization_id",e);l?a.documents=0:a.documents=c||0;let{count:d,error:m}=await i.N.from("passwords").select("*",{count:"exact",head:!0}).eq("organization_id",e);m?a.passwords=0:a.passwords=d||0;let{count:u,error:h}=await i.N.from("configurations").select("*",{count:"exact",head:!0}).eq("organization_id",e);h?a.configurations=0:a.configurations=u||0;let{count:g,error:b}=await i.N.from("networks").select("*",{count:"exact",head:!0}).eq("organization_id",e);b?a.networks=0:a.networks=g||0;let{count:f,error:x}=await i.N.from("ssl_certificates").select("*",{count:"exact",head:!0}).eq("organization_id",e);x?a.ssl_certificates=0:a.ssl_certificates=f||0;let{count:N,error:y}=await i.N.from("domains").select("*",{count:"exact",head:!0}).eq("organization_id",e);return y?a.domains=0:a.domains=N||0,this.cache.set(t,{data:a,timestamp:Date.now()}),a}catch(e){return{}}}static clearCache(e){e?(this.cache.delete("sidebar_".concat(e)),this.cache.delete("items_".concat(e)),this.cache.delete("counts_".concat(e))):this.cache.clear()}static clearCacheIfDifferentOrg(e){Array.from(this.cache.keys()).some(t=>t.includes("sidebar_")&&!t.includes(e))&&this.cache.clear()}static async getOrganizationSidebarItems(e){let t="items_".concat(e),a=this.cache.get(t);if(a&&Date.now()-a.timestamp<this.CACHE_DURATION)return a.data;let{data:s,error:n}=await i.N.from("organization_sidebar_items").select("*").eq("organization_id",e).eq("is_active",!0).order("sort_order",{ascending:!0});if(n)throw n;let r=s||[];return this.cache.set(t,{data:r,timestamp:Date.now()}),r}static async getOrganizationSidebarByCategory(e){let t="sidebar_".concat(e),a=this.cache.get(t);if(a&&Date.now()-a.timestamp<this.CACHE_DURATION)return a.data;let i=await this.getOrganizationSidebarItems(e),s=await this.getOrganizationCounts(e),n={"CLIENT CONTACT":{name:"CLIENT CONTACT",items:[],systemItems:[{name:"Site Summary",href:"/site-summary",icon:"FileText",count:1},{name:"Site Summary (Legacy)",href:"/site-summary-legacy",icon:"Archive",count:1},{name:"After Hour and Building/Site...",href:"/after-hour-access",icon:"Clock",count:1},{name:"Onsite Information",href:"/onsite-information",icon:"AlertTriangle"},{name:"Locations",href:"/locations",icon:"MapPin",count:s.locations||0},{name:"Contacts",href:"/contacts",icon:"Users",count:s.contacts||0}]},"CORE DOCUMENTATION":{name:"CORE DOCUMENTATION",items:[],systemItems:[{name:"TIS Standards Exception",href:"/tis-standards-exception",icon:"AlertTriangle"},{name:"TIS Contract Exceptions",href:"/tis-contract-exceptions",icon:"FileX"},{name:"Request for Change Form (RFC)",href:"/rfc",icon:"Clock"},{name:"Change Log",href:"/change-log",icon:"FileText"},{name:"Configurations",href:"/configurations",icon:"Settings",count:s.configurations||0},{name:"Documents",href:"/documents",icon:"FileText",count:s.documents||0},{name:"Domains - Liongard",href:"/domains-liongard",icon:"FileText",count:s.domains||0},{name:"Domain Tracker",href:"/domain-tracker",icon:"Globe",count:s.domains||0},{name:"Known Issues",href:"/known-issues",icon:"AlertTriangle",count:0},{name:"Maintenance Windows",href:"/maintenance-windows",icon:"Zap"},{name:"Multi-Factor Authentication",href:"/mfa",icon:"Shield",count:0},{name:"Networks",href:"/networks",icon:"Network",count:s.networks||0},{name:"Passwords",href:"/passwords",icon:"Key",count:s.passwords||0},{name:"SSL Tracker",href:"/ssl-tracker",icon:"Lock",count:s.ssl_certificates||0},{name:"TLS/SSL Certificate",href:"/tls-ssl-certificate",icon:"Shield",count:s.ssl_certificates||0}]}};return i.forEach(e=>{let t=e.parent_category||"CLIENT CONTACT";n[t]||(n[t]={name:t,items:[],systemItems:[]}),n[t].items.push(e)}),this.cache.set(t,{data:n,timestamp:Date.now()}),n}static async createSidebarItem(e){try{let{data:a,error:s}=await i.N.from("organization_sidebar_items").insert([e]).select().single();if(s){var t;if("42P01"===s.code)throw Error('Database table "organization_sidebar_items" does not exist. Please run the database setup SQL first.');if("23505"===s.code)throw Error("A sidebar item with this slug already exists for this organization.");if(null==(t=s.message)?void 0:t.includes("timeout"))throw Error("Database connection timeout. Please try again.");else throw Error("Database error: ".concat(s.message||"Unknown error"))}return this.clearCache(e.organization_id),a}catch(e){throw e}}static async updateSidebarItem(e,t){let{data:a,error:s}=await i.N.from("organization_sidebar_items").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s)throw s;return a}static async deleteSidebarItem(e){let{error:t}=await i.N.from("organization_sidebar_items").delete().eq("id",e);if(t)throw t}static getAvailableIcons(){return[{value:"FileText",label:"Document"},{value:"Folder",label:"Folder"},{value:"Users",label:"Users"},{value:"Phone",label:"Phone"},{value:"Mail",label:"Email"},{value:"Settings",label:"Settings"},{value:"Code",label:"Code"},{value:"Database",label:"Database"},{value:"Server",label:"Server"},{value:"Network",label:"Network"},{value:"Shield",label:"Security"},{value:"Key",label:"Key"},{value:"Lock",label:"Lock"},{value:"Globe",label:"Globe"},{value:"Calendar",label:"Calendar"},{value:"Clock",label:"Clock"},{value:"Bug",label:"Bug"},{value:"AlertTriangle",label:"Alert"},{value:"CheckCircle",label:"Check"},{value:"Info",label:"Info"},{value:"Star",label:"Star"},{value:"Heart",label:"Heart"},{value:"Bookmark",label:"Bookmark"},{value:"Tag",label:"Tag"}]}static getAvailableCategories(){return[{value:"CLIENT CONTACT",label:"Client Contact"},{value:"CORE DOCUMENTATION",label:"Core Documentation"}]}}s.cache=new Map,s.CACHE_DURATION=3e4},84559:(e,t,a)=>{Promise.resolve().then(a.bind(a,86462))},86462:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var i=a(95155),s=a(12115),n=a(35695),r=a(45745),o=a(42099);function c(){var e;let t=(0,n.useRouter)(),[a,c]=(0,s.useState)([]),[l,d]=(0,s.useState)(""),[m,u]=(0,s.useState)(null),[h,g]=(0,s.useState)(!1);(0,s.useEffect)(()=>{b()},[]);let b=async()=>{try{let{data:e,error:t}=await o.N.from("organizations").select("id, name").limit(10);if(t)throw t;c(e||[])}catch(e){}},f=async e=>{g(!0),d(e);try{r.o.clearCache();let t=await r.o.getOrganizationSidebarByCategory(e);u(t)}catch(e){u(null)}g(!1)},x=async e=>{if(e){g(!0);try{var t;let i={organization_id:e,parent_category:"CLIENT CONTACT",item_name:"Test Item for ".concat((null==(t=a.find(t=>t.id===e))?void 0:t.name)||"Org"),item_slug:"test-item-".concat(Date.now()),item_type:"page",icon:"FileInput",description:"Test custom sidebar item",sort_order:100,is_active:!0,is_system:!1},{data:s,error:n}=await o.N.from("organization_sidebar_items").insert([i]).select().single();if(n)throw n;await f(e)}catch(e){}g(!1)}};return(0,i.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white p-8",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Organization Switching Debug"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,i.jsxs)("div",{className:"bg-gray-800 p-6 rounded",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Organizations"}),(0,i.jsx)("div",{className:"space-y-2",children:a.map(e=>(0,i.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-700 rounded",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium",children:e.name}),(0,i.jsx)("div",{className:"text-xs text-gray-400",children:e.id})]}),(0,i.jsxs)("div",{className:"flex space-x-2",children:[(0,i.jsx)("button",{onClick:()=>f(e.id),disabled:h,className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm disabled:opacity-50",children:"Load Sidebar"}),(0,i.jsx)("button",{onClick:()=>{var a;return a=e.id,void t.push("/organizations/".concat(a))},className:"px-3 py-1 bg-green-600 hover:bg-green-700 rounded text-sm",children:"Navigate"}),(0,i.jsx)("button",{onClick:()=>x(e.id),disabled:h,className:"px-3 py-1 bg-purple-600 hover:bg-purple-700 rounded text-sm disabled:opacity-50",children:"Add Test Item"})]})]},e.id))})]}),(0,i.jsxs)("div",{className:"bg-gray-800 p-6 rounded",children:[(0,i.jsxs)("h2",{className:"text-lg font-semibold mb-4",children:["Sidebar Data",l&&(0,i.jsxs)("span",{className:"text-sm text-gray-400 ml-2",children:["(",(null==(e=a.find(e=>e.id===l))?void 0:e.name)||l,")"]})]}),h&&(0,i.jsx)("div",{className:"text-yellow-400",children:"Loading..."}),m&&!h&&(0,i.jsx)("div",{className:"space-y-4",children:Object.entries(m).map(e=>{let[t,a]=e;return(0,i.jsxs)("div",{className:"bg-gray-700 p-3 rounded",children:[(0,i.jsx)("h3",{className:"font-medium text-blue-400 mb-2",children:t}),a.items&&a.items.length>0?(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("div",{className:"text-sm text-green-400",children:["Custom Items (",a.items.length,"):"]}),a.items.map((e,t)=>(0,i.jsxs)("div",{className:"text-xs text-gray-300 ml-2",children:["â€¢ ",e.item_name," (",e.item_slug,")"]},t))]}):(0,i.jsx)("div",{className:"text-xs text-gray-400",children:"No custom items"}),a.systemItems&&(0,i.jsxs)("div",{className:"text-xs text-gray-500 mt-2",children:["System items: ",a.systemItems.length]})]},t)})}),!m&&!h&&(0,i.jsx)("div",{className:"text-gray-400",children:"No sidebar data loaded. Select an organization above."})]})]}),(0,i.jsxs)("div",{className:"mt-8 bg-blue-900/20 border border-blue-600 rounded-lg p-4",children:[(0,i.jsx)("h3",{className:"text-blue-400 font-semibold mb-2",children:"Testing Instructions:"}),(0,i.jsxs)("ol",{className:"text-blue-200 text-sm space-y-1",children:[(0,i.jsx)("li",{children:'1. Click "Add Test Item" for different organizations to create custom sidebar items'}),(0,i.jsx)("li",{children:'2. Click "Load Sidebar" to see the sidebar data for each organization'}),(0,i.jsx)("li",{children:"3. Verify that each organization shows only its own custom items"}),(0,i.jsx)("li",{children:'4. Click "Navigate" to go to the actual organization page and verify the sidebar'}),(0,i.jsx)("li",{children:"5. Switch between organizations and verify the sidebar updates correctly"})]})]})]})}}},e=>{e.O(0,[5647,8441,5964,7358],()=>e(e.s=84559)),_N_E=e.O()}]);